@page "/Dashboard/Dashboard"
@model ATSSFG.Pages.Dashboard.DashboardModel
@{
    string department = HttpContext?.Session.GetString("Dept") ?? "";
    string encoder = HttpContext?.Session.GetString("Encoder") ?? "";
    string processor = HttpContext?.Session.GetString("Processor") ?? "";
    string viewer = HttpContext?.Session.GetString("Viewer") ?? "";
    string Admin = HttpContext?.Session.GetString("Admin") ?? "";

    bool isAdmin = Admin.Equals("True", StringComparison.OrdinalIgnoreCase);
}
<div class="row mt-2">
    <div class="col-sm-4 col-md-6 col-lg-3 mb-2">
        <div class="card shadow bg-warning border-3 border-warning-subtle">
            <div class="card-body" type="button" data-mdb-toggle="modal" data-mdb-target="#pendingModal">
                <div class="row align-items-center">
                    <div class="col-auto">
                        <i class="fa-solid fa-circle-exclamation h1 text-white"></i>
                    </div>
                    <div class="col me-2">
                        <div class="text-white text-end">
                            <h4 class="fs-1">0</h4>
                        </div>
                        <div class="text-end text-white">
                            <h4 class="fs-6">Open RFQ</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-6 col-lg-3 mb-2">
        <div class="card shadow bg-success border-3 border-success-subtle">
            <div class="card-body" type="button" data-mdb-toggle="modal" data-mdb-target="#closedModal">
                <div class="row align-items-center">
                    <div class="col-auto">
                        <i class="fa-solid fa-circle-check h1 text-white"></i>
                    </div>
                    <div class="col me-2">
                        <div class="text-white text-end">
                            <h4 class="fs-1">0</h4>
                        </div>
                        <div class="text-end text-white">
                            <h4 class="fs-6">Closed RFQ</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-md-6 col-lg-3 mb-2">
        <div class="row mx-0">
            <a asp-page="/Dashboard/ProjectSummaryReport" class="btn btn-primary border-2 border-primary-subtle my-2">Project Summary Report</a>
            <a asp-page="/Dashboard/OpenProjects" class="btn btn-primary border-2 border-primary-subtle my-2">OPEN Projects</a>
        </div>
    </div>
    <div class="col-sm-4 col-md-6 col-lg-3 mb-2">
        <div class="card shadow bg-main3 border-2 border-primary-subtle h-100">
            <div class="card-body" type="button" data-bs-toggle="modal" data-bs-target="#menuSFG">
                <div class="row align-items-center">
                    <div class="col">
                        <h4>Sourcing Form Generation</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12 col-xl-6 my-2">
        <div class="card">
            <div class="card-header bg-main3">
                <h5 class="card-title">Summary of RFQ per month (Unique/Common)</h5>
            </div>
            <div class="card-body">
                <div class="col-sm-4 col-lg-4">
                    <div class="input-group">
                        <label class="input-group-text bg-main3" for="monthFilter1"><i class="fa-regular fa-calendar"></i></label>
                        <input type="month" name="month1" id="monthFilter1" class="form-control">
                    </div>
                </div>
                <canvas id="myChart1"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-12 col-xl-6 my-2">
        <div class="card">
            <div class="card-header bg-main3">
                <h5 class="card-title">Sourcing TAT</h5>
            </div>
            <div class="card-body">
                <div class="row align-items-center justify-content-between">
                    <div class="col-sm-4 col-lg-4">
                        <div class="input-group">
                            <label class="input-group-text bg-main3" for="monthFilter2"><i class="fa-regular fa-calendar"></i></label>
                            <input type="month" name="month2" id="monthFilter2" class="form-control">
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="bg-main3 p-2 rounded">
                            <h6 class="mb-0">Average TAT: 2.5</h6>
                        </div>
                    </div>
                </div>
                <canvas id="myChart2"></canvas>
            </div>
        </div>
    </div>
</div>
<div>
    <!--Menu Modal -->
    <div class="modal fade" id="menuSFG" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="menuSFGLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-main3">
                    <h1 class="modal-title fs-5" id="menuSFGLabel">@department</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-2">
                        @if (department == "Cost Engineering" && encoder == "True" || isAdmin)
                        {
                            <button type="button" class="btn bg-main3 encoder" data-bs-toggle="modal" data-bs-target="#encoder">
                                ENCODER
                            </button>

                        }

                        @if (department == "Cost Engineering" && processor == "True" || department == "Sourcing" && processor == "True" || isAdmin)
                        {
                            <button type="button" class="btn bg-main3 processor" data-bs-toggle="modal" data-bs-target="#processor">
                                PROCESSOR
                            </button>
                        }

                        @if (viewer == "True" || isAdmin)
                        {
                            <button type="button" class="btn bg-main3 viewer" data-bs-toggle="modal" data-bs-target="#viewer" id="viewRFQProjectsBtn">
                                VIEWER
                            </button>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    @Html.AntiForgeryToken()
    @await Html.PartialAsync("_DashboardModals")
    
</div>
<!-- Open Sourcing Form Modal -->
<div class="modal fade" id="sourcingForm" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="sourcingFormLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-main3">
                <h1 class="modal-title fs-5" id="sourcingFormLabel"> <i class="fa-solid fa-file-arrow-up"></i> Sourcing Form</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-2">
                    <h4>MRP BOM</h4>
                    <div class="row d-flex align-items-center">
                        <div class="col-sm col-lg-6">
                            <h6>Part Number/Description</h6>
                        </div>
                        <div class="col-sm col-lg-6">
                            <select class="form-select" id="sourcingFormSelect">
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-primary border-3 border-primary-subtle" data-bs-toggle="modal" data-bs-target="#sourcingFormModal">
                    <i class="fa-solid fa-circle-plus"></i> Create Sourcing Form without BOM 
                </button>
                <button type="button" class="btn btn-primary border-3 border-primary-subtle d-none" id="viewPNDesc"><i class="fa-solid fa-eye"></i> View</button>
            </div>
        </div>
    </div>
</div>
@await Html.PartialAsync("_DashboardRFQForm")
<!-- Show RFQ Library Model-->
<div class="modal fade" id="library" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="libraryLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-main3">
                <h1 class="modal-title fs-5" id="libraryLabel"> <i class="fa-solid fa-file-arrow-up"></i> Sourcing Form | <span class="badge text-bg-dark">Viewer</span></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive mb-2">
                    <table class="table table-striped table-hover" id="libraryTable" style="width: 100%;">
                        <thead class="table-secondary">
                            <tr>
                                <th>Quotation Number</th>
                                <th>Request Date</th>
                                <th>Part Number</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody class="text-nowrap">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Show Incoming RFQ Modal-->
<div class="modal fade" id="incomingRFQ" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="incomingRFQLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-main3">
                <h1 class="modal-title fs-5" id="incomingRFQLabel"> <i class="fa-solid fa-file-arrow-up"></i> Sourcing Form | <span class="badge text-bg-dark">Processor</span></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive mb-2">
                    <table class="table table-striped table-hover" id="incomingRFQTable" style="width: 100%;">
                        <thead class="table-secondary">
                            <tr>
                                <th>Quotation Number</th>
                                <th>Request Date</th>
                                <th>Part Number</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody class="text-nowrap">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
         let department = "@department";
         const viewer = "@viewer";
    </script>
    <script src="~/JavaScript/Dashboard.js"></script>
    <script src="~/JavaScript/DashboardCharts.js"></script>
}